{"remainingRequest":"/Users/finup/WebstormProjects/front-test-platform/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/finup/WebstormProjects/front-test-platform/src/views/User/User.vue?vue&type=style&index=0&id=768dc365&lang=scss&scoped=true&","dependencies":[{"path":"/Users/finup/WebstormProjects/front-test-platform/src/views/User/User.vue","mtime":1616145119617},{"path":"/Users/finup/WebstormProjects/front-test-platform/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/finup/WebstormProjects/front-test-platform/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/finup/WebstormProjects/front-test-platform/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/finup/WebstormProjects/front-test-platform/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/finup/WebstormProjects/front-test-platform/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/finup/WebstormProjects/front-test-platform/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKQGltcG9ydCAifkAvYXNzZXRzL3Njc3MvY29tbW9uLnNjc3MiOwo="},{"version":3,"sources":["User.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwTA","file":"User.vue","sourceRoot":"src/views/User","sourcesContent":["<template>\n  <div class=\"manage\">\n    <el-dialog :title=\"operateType === 'add' ? '新增用户' : '更新用户'\" :visible.sync=\"isShow\" :show-close=\"false\">\n      <common-form :form-label=\"operateFormLabel\" :form=\"operateForm\" ref=\"commonForm\" :rules=\"userRules\"\n                   :is-ok=\"isOk\"></common-form>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"exit\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"confirm\">确 定</el-button>\n      </span>\n    </el-dialog>\n    <div class=\"manage-header\">\n      <el-button type=\"primary\" @click=\"addUser\">+ 新增</el-button>\n      <common-form inline :formLabel=\"formLabel\" :form=\"searchFrom\">\n        <el-button type=\"primary\" @click=\"getList\">查询</el-button>\n      </common-form>\n    </div>\n    <common-table :tableData=\"tableData\" :tableLabel=\"tableLabel\" :config=\"config\" @changePage=\"getList\"\n                  @edit=\"editUser\" @del=\"delUser\" :is-show-table=\"isShowTable\" :right-width=\"rightWidth\"></common-table>\n  </div>\n</template>\n<script>\nimport CommonForm from \"@/components/CommonForm\";\nimport CommonTable from \"@/components/CommonTable\"\nimport {getUserListApi, addUserApi, updateUserApi, deleteUserApi} from \"@/api/getData\";\nimport {isInArray} from \"@/api/publicMethod\";\n\nexport default {\n  components: {\n    CommonTable,\n    CommonForm\n  },\n  data() {\n    return {\n      operateType: 'add',\n      rightWidth: '180',\n      isShow: false,\n      isShowTable: true,\n      isOk: false,\n      tableData: [],\n      tableLabel: [\n        {\n          prop: 'name',\n          label: '用户名'\n        },\n        {\n          prop: 'mail_box',\n          label: '邮箱',\n          width: 270\n        },\n        {\n          prop: 'age',\n          label: '年龄'\n        },\n        {\n          prop: 'department',\n          label: '部门',\n          width: 200\n        },\n        {\n          prop: 'position',\n          label: '职位',\n          width: 200\n        }\n      ],\n      config: {\n        page: 1,\n        total: 1,\n        size: 10,\n        loading: false\n      },\n      operateForm: {\n        id: '',\n        name: '',\n        pwd: '',\n        mail_box: '',\n        age: '',\n        department: '',\n        position: ''\n      },\n      operateFormLabel: [\n        {\n          model: 'name',\n          label: '用户名'\n        },\n        {\n          model: 'mail_box',\n          label: '邮箱'\n        },\n        {\n          model: 'age',\n          label: '年龄'\n        },\n        {\n          model: 'department',\n          label: '部门'\n        },\n        {\n          model: 'position',\n          label: '职位'\n        }\n      ],\n      userRules: {\n        name: [\n          {required: true, message: '请输入用户名', trigger: 'blur'},\n          {pattern: /^[a-zA-Z0-9]{5,32}$/, message: '用户名长度为5-32个字符'}\n        ],\n        pwd: [\n          {required: true, message: '请输入密码', trigger: 'blur'},\n          {pattern: /^[a-zA-Z]\\w{5,17}$/, message: '密码规则以字母开头，长度在6~18之间，只能包含字母、数字和下划线'}\n        ],\n        mail_box: [\n          {required: true, message: '请输入邮箱', trigger: 'blur'},\n          {\n            pattern: /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/,\n            message: '邮箱格式错误'\n          }\n        ],\n        age: [\n          {required: true, message: '请输入年龄', trigger: 'blur'},\n          {pattern: /(^[0-9]{1,2}$)/, message: '年龄必须是整数且最多2位'}\n        ],\n        department: [\n          {required: true, message: '请输入部门', trigger: 'blur'},\n          {min: 0, max: 128, message: '部门最长为128个字符', trigger: 'blur'},\n        ],\n        position: [\n          {required: true, message: '请输入职位', trigger: 'blur'},\n          {min: 0, max: 128, message: '职位最长为128个字符', trigger: 'blur'},\n        ]\n      },\n      formLabel: [\n        {\n          model: 'keyword',\n          label: ''\n        }\n      ],\n      searchFrom: {\n        keyword: ''\n      },\n    }\n  },\n  methods: {\n    async getList() {\n      try {\n        this.searchFrom.keyword ? (this.config.page = 1) : ''\n        this.config.loading = true\n        let result = await getUserListApi(this.$store.state.data.token, this.config.page, this.config.size, this.searchFrom.keyword)\n        if (result.data.code === 0) {\n          result = result.data.data;\n          this.tableData = result.rows;\n          this.config.total = result.total;\n          this.tableData.forEach(item => {\n            item.type = 'user'\n          });\n        } else {\n          return null\n        }\n      } catch (e) {\n        console.log('getList', e)\n      } finally {\n        this.config.loading = false\n        this.searchFrom.keyword = ''\n      }\n    },\n    editUser(row) {\n      this.operateType = 'edit'\n      if (isInArray(this.operateFormLabel, 'pwd')) {\n        this.operateFormLabel.splice(this.operateFormLabel.length - 1, 1)\n      }\n      this.isShow = true\n      this.operateForm = row\n    },\n    async confirm() {\n      try {\n        if (this.operateType === 'edit') {\n          //判断是否符合验证条件，符合将isOk设置为true\n          this.$refs.commonForm.$refs['form'].validate((valid) => {\n            if (valid) {\n              this.isOk = true\n            }\n          })\n          if (this.isOk) {\n            let result = await updateUserApi(this.$store.state.data.token, this.operateForm.id, this.operateForm.name,\n                this.operateForm.mail_box, this.operateForm.age, this.operateForm.department, this.operateForm.position)\n            if (result.data.code === 0) {\n              this.$notify({\n                title: '',\n                message: '更新成功',\n                duration: 1000,\n                type: 'success',\n                onClose: () => {\n                  this.isShow = false\n                  this.getList()\n                }\n              });\n            } else {\n              this.$notify.error({\n                title: '',\n                message: '更新失败',\n                duration: 1000,\n                onClose: () => {\n                  this.isShow = false\n                  this.config.page = 1\n                  this.getList()\n                }\n              });\n            }\n            this.isOk = false\n          }\n        } else {\n          //判断是否符合验证条件，符合将isOk设置为true\n          this.$refs.commonForm.$refs['form'].validate((valid) => {\n            if (valid) {\n              this.isOk = true\n            }\n          })\n          if (this.isOk) {\n            let result = await addUserApi(this.$store.state.data.token, this.operateForm.name, this.operateForm.mail_box,\n                this.operateForm.age, this.operateForm.department, this.operateForm.position, this.operateForm.pwd)\n            if (result.data.code === 0) {\n              this.$notify({\n                title: '',\n                message: '添加成功',\n                duration: 1000,\n                type: 'success',\n                onClose: () => {\n                  this.isShow = false\n                  this.config.page = 1\n                  this.getList()\n                }\n              });\n            } else {\n              this.$notify.error({\n                title: '',\n                message: '添加失败',\n                duration: 1000,\n                onClose: () => {\n                  this.isShow = false\n                  this.config.page = 1\n                  this.getList()\n                }\n              });\n            }\n            this.isOk = false;\n          }\n        }\n      } catch (e) {\n        console.log(`confirm`, e)\n      }\n    },\n    delUser(row) {\n      try {\n        this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(async () => {\n          let id = row.id\n          let result = await deleteUserApi(this.$store.state.data.token, id)\n          if (result.data.code === 0) {\n            this.$notify({\n              title: '',\n              message: '删除成功',\n              duration: 1000,\n              type: 'success',\n              onClose: () => {\n                location.reload()\n              }\n            });\n          } else {\n            this.$notify.error({\n              title: '',\n              message: '删除失败',\n              duration: 1000,\n              onClose: () => {\n                this.config.page = 1\n                this.getList()\n              }\n            });\n          }\n        }).catch(() => {\n          this.config.page = 1\n          this.getList()\n        });\n      } catch (e) {\n        console.log(`delUser`,e)\n      }\n    },\n    addUser() {\n      if (!isInArray(this.operateFormLabel, 'pwd')) {\n        this.operateFormLabel.push({\n          model: 'pwd',\n          label: '密码',\n          type: 'password'\n        })\n      }\n      this.operateForm = {}\n      this.operateType = 'add'\n      this.isShow = true\n    },\n    exit() {\n      this.isShow = false\n      this.getList()\n      this.$refs.commonForm.$refs['form'].clearValidate()\n    }\n  },\n  created() {\n    this.getList()\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n@import \"~@/assets/scss/common.scss\";\n</style>"]}]}